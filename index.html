<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Baku Card</title>
  <meta name="description" content="–° –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è! ‚ô•Ô∏è" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="HB Kovich" />
  <meta property="og:description" content="–° –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è! ‚ô•Ô∏è" />
  <meta property="og:image" content="optimized/poster.jpg" />
  <meta name="theme-color" content="#ffffff" />

  <!-- Preload poster for snappy playback -->
  <link rel="preload" as="image" href="optimized/poster.jpg" fetchpriority="high" />

  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
  <link rel="manifest" href="/favicons/site.webmanifest">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap');

    :root {
      --bg: #f8f8f8;
      --fg: #0f0f0f;
      --btn: #111;
      --btn-fg: #fff;
      --accent: #ff85a1;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, "Noto Sans", Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      display: grid;
      place-items: center;
      gap: 16px;
    }

    .wrap {
      --stage-width: min(100vw, 480px);
      width: var(--stage-width);
      height: 100vh;
      padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom);
    }

    .stage {
      position: relative;
      width: 100%;
      aspect-ratio: 9/16;
      overflow: hidden;
      background: #000;
      box-shadow: 0 10px 40px rgba(0, 0, 0, .15);
    }

    video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      opacity: 0;
      transition: opacity 200ms linear;
    }


    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 12px;
    }

    button {
      -webkit-tap-highlight-color: transparent;
      cursor: pointer;
      border: 0;
      border-radius: 999px;
      padding: 12px 18px;
      font-size: 16px;
      font-weight: 600;
      background: var(--btn);
      color: var(--btn-fg);
      box-shadow: 0 6px 18px rgba(0, 0, 0, .12);
      transition: all 200ms ease;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: scale(0.95);
    }

    .hint {
      text-align: center;
      font-size: 12px;
      opacity: .6;
      margin-top: 8px;
    }

    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: white;
      font-size: 18px;
      font-weight: 600;
      z-index: 10;
    }

    .loading-progress {
      width: 200px;
      height: 6px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
      overflow: hidden;
      margin: 0 auto 16px;
      position: relative;
    }

    .loading-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #ff85a1, #ff6b9d);
      border-radius: 3px;
      width: 0%;
      transition: width 0.3s ease;
      position: relative;
    }

    .loading-progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%);
      }

      100% {
        transform: translateX(100%);
      }
    }

    .loading-text {
      font-size: 14px;
      opacity: 0.9;
    }

    .stage.loading video {
      opacity: 0;
    }

    .main-screen {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: end;
      z-index: 20;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .main-screen.visible {
      opacity: 1;
    }

    .poster-background {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      opacity: 1;
    }

    .main-screen-content {
      display: flex;
      flex-direction: row;
      gap: 10px;
      margin-bottom: 17%
    }

    .main-btn {
      background: transparent;
      /* –í—Ä–µ–º–µ–Ω–Ω—ã–π —è—Ä–∫–∏–π —Ñ–æ–Ω –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ */
      border: 1.5px solid white;
      color: white;
      font-size: 14px;
      font-weight: 600;
      padding: 16px 32px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      z-index: 21;
      opacity: 1 !important;
      visibility: visible !important;
      display: block !important;
      min-width: 120px;
      min-height: 50px;
    }

    .main-btn:hover {
      background: #ff85a263;
      color: white;
      box-shadow: 0 8px 24px rgba(255, 133, 161, 0.4);
    }

    .main-btn:active {
      transform: translateY(0);
    }

    .whishes-text {
      font-family: 'Lora', serif;
      font-size: calc(var(--stage-width) * 0.032);
      font-weight: 500;
      font-style: normal;
      position: absolute;
      left: 19%;
      top: 42%;
      width: 64%;
      height: 26%;
      text-align: left;
      color: #222222;
      opacity: 0;
      z-index: 21;
      transform: rotate(0.9deg);
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      box-sizing: border-box;
      transition: opacity 1s ease, transform 1s ease;
      line-height: 1.55;
      letter-spacing: 0.1vw;
      overflow: hidden;
    }

    .wishes-content {
      display: flex;
      justify-content: flex-start;
      overflow: auto;
    }

    .whishes-text.show {
      opacity: 0.9;
    }

    .wishes-signature {
      font-family: 'Lora', serif;
      font-size: calc(var(--stage-width) * 0.028);
      font-weight: 500;
      font-style: italic;
      color: #444444;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1s ease;
      text-align: right;
      line-height: 1.2;
      letter-spacing: 0.05vw;
      margin-top: 10px;
      align-self: flex-end;
    }

    .wishes-signature.show {
      opacity: 0.8;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="stage loading" id="stage">
      <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
      <div class="loading" id="loadingIndicator">
        <div class="loading-progress">
          <div class="loading-progress-bar" id="progressBar"></div>
        </div>
        <div class="loading-text" id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="loading-details" id="loadingDetails" style="font-size: 12px; opacity: 0.7; margin-top: 8px;"></div>
      </div>



      <!-- –§–æ–Ω–æ–≤—ã–π –ø–æ—Å—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ –≤–∏–¥–µ–Ω -->
      <img id="posterBackground" class="poster-background" src="optimized/poster.jpg" alt="Baku poster" />

      <div id="mainScreen" class="main-screen">
        <div class="main-screen-content">
          <button id="nextBtn" class="main-btn">Read</button>
          <button id="showBtn" class="main-btn">Look</button>
        </div>
      </div>

      <div id="whishesText" class="whishes-text">
        <div class="wishes-content">
          –° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è!<br>
          –ñ–µ–ª–∞—é —Å—á–∞—Å—Ç—å—è, –∑–¥–æ—Ä–æ–≤—å—è<br>
          –∏ —Ä–∞–¥–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å!
        </div>
        <div id="wishesSignature" class="wishes-signature">
          ‚Äî –ú–∞–º–∞
        </div>
      </div>


    </div>
  </div>


  <script>
    (function () {
      const qs = new URLSearchParams(location.search);

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä—É—Å—Å–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –Ω–∞–ø—Ä—è–º—É—é

      // Map –∫–ª–∏–ø–æ–≤ (—ç–ª–µ–º–µ–Ω—Ç—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
      const clips = [
        { id: 'bouquet', el: null, src: 'optimized/bouquet_optimized.mp4', weight: 1 },
        { id: 'paper', el: null, src: 'optimized/paper_optimized.mp4', weight: 1 },
        { id: 'dance', el: null, src: 'optimized/dance_optimized.mp4', weight: 1 },
        { id: 'blowKiss', el: null, src: 'optimized/blowKiss_optimized.mp4', weight: 1 },
        { id: 'twerk', el: null, src: 'optimized/twerk_optimized.mp4', weight: 1 }
      ];

      // –ú–∞—Å—Å–∏–≤ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Å–º–µ–Ω—ã
      const wishes = [
        {
          id: 'timur-1',
          text: `"–í—ã –ø–æ–º–Ω–∏—Ç–µ, –≤—ã –≤—Å—ë –∫–æ–Ω–µ—á–Ω–æ –ø–æ–º–Ω–∏—Ç–µ". –ê —á—Ç–æ –∑–∞–±—ã–ª–∞, —è –≤—Å–ø–æ–º–Ω—é –∑–∞ –Ω–∞—Å –¥–≤–æ–∏—Ö. –û–±–µ—â–∞—é, —Ç–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–µ–µ.</br></br>–õ—é–±–ª—é. –° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è.`,
          signature: "‚Äî –¢–∏–º—É—Ä"
        },
        {
          id: 'ellada-1',
          text: `–ñ–µ–Ω—è, –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è –º–æ—è –∫–æ—à–µ—á–∫–∞, –∂–µ–ª–∞—é —Ç–µ–±–µ –ª–µ–≥–∫–æ–≥–æ —Å—á–∞—Å—Ç–ª–∏–≤–æ–≥–æ –≥–æ–¥–∞, —Å–∏–ª –∏ —Ç–µ–ø–ª–∞, —É–¥–∞—á–∏ –∏ —Ä–∞–¥–æ—Å—Ç–∏! –û–±–Ω–∏–º–∞—é –∫—Ä–µ–ø–∫–æ –∫—Ä–µ–ø–∫–æ. –ù–∞–¥–µ—é—Å—å –Ω–∞ –≤—Å—Ç—Ä–µ—á—É. –ü—Ä–∏–≤–µ—Ç—ã –∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç –º–æ–∏—Ö –º—É–∂—á–∏–Ω.</br>P.S. –ö—Å—Ç–∞—Ç–∏, –¢–∏–º —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤ –Ø–ø–æ–Ω–∏—é)
`,
          signature: "‚Äî –≠–ª–ª–∞–¥–∞"
        },
        {
          id: 'nastya-1',
          text: `–î—Ä—É–∑—å—è, —ç—Ç–æ —Å–µ–º—å—è –∫–æ—Ç–æ—Ä—É—é –º—ã –≤—ã–±–∏—Ä–∞–µ–º —Å–∞–º–∏. –Ø —Å—á–∞—Å—Ç–ª–∏–≤–∞, —á—Ç–æ —Ç—ã –µ—Å—Ç—å, —á—Ç–æ –º—ã –µ—Å—Ç—å –¥—Ä—É–≥ —É –¥—Ä—É–≥–∞, –∏ —Å–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –º–æ—è —Å–µ–º—å—è. –Ø —Ç–µ–±—è –ª—é–±–ª—é.`,
          signature: "‚Äî –ù–∞—Å—Ç—è"
        },
        {
          id: 'nastya-2',
          text: `„ÅÇ„Å™„Åü„ÅÆ„Åì„Å®„Åå„Åú„Çì„Å∂„Åô„Åç`,
          signature: "‚Äî –ù–∞—Å—Ç—è"
        },
        {
          id: 'marina-1',
          text: `–ú–æ—è –ª—é–±–∏–º–∞—è —Ñ–µ—è, –∂–µ–ª–∞—é —Ç–µ–±–µ –∫—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è, –ª–µ–≥–∫–æ—Å—Ç–∏ –±—ã—Ç–∏—è –∏ –Ω–µ–∏—Å—Å—è–∫–∞–µ–º–æ–≥–æ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è! –ü–æ–º–Ω–∏, —á—Ç–æ –µ—Å—Ç—å –ª—é–¥–∏ –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–±—è –ª—é–±—è—Ç –í–°–ï–ì–î–ê!`,
          signature: "‚Äî –ú–∞—Ä–∏–Ω–∞"
        },
        {
          id: 'adil-1',
          text: `–° —Ç–≤–æ–∏–º –¥–Ω–µ–º, –∫–æ–≥–¥–∞ —Ç—ã —É–ª—ã–±–∞–µ—à—å—Å—è, –ª–µ—Ç–æ–º –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∏–º–∞, –∏ —ç—Ç–æ —Ç–∞–∫ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ, –∫–∞–∫ –ø–æ–µ–∑–¥–∫–∞ –Ω–∞ –º–æ—Ç–æ—Ü–∏–∫–ª–µ, —Å–≤–µ—Ç–∏ !`,
          signature: "‚Äî –ê–¥–∏–ª—å"
        },
        {
          id: 'sergei-1',
          text: `Thank you my love for letting each other come into each others arms. I wish you love, peace, creativity and content to the next year.`,
          signature: "‚Äî Sergei"
        },
        {
          id: 'hanna-1',
          text: `–ü—É—Å—Ç—å –≤—Å–µ —á—Ç–æ —Ç—ã –Ω–∞–∑—ã–≤–∞–µ—à—å –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–º, —Å—Ç–∞–Ω–µ—Ç —á–∞—Å—Ç—å—é —Ç–≤–æ–µ–≥–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ.</br></br>–õ—é–±–ª—é —Ç–µ–±—è, –±—É–¥—å –∑–¥–æ—Ä–æ–≤–µ–Ω—å–∫–æ–π,`,
          signature: "‚Äî –•–∞–Ω–Ω–∞"
        },
        {
          id: 'roma-1',
          text: `–±–æ–ª—å—à–µ –ø—Ä–∏—è—Ç–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤ –∫–∞–∫ –ø–æ–µ–∑–¥–∫–∏ –≤ —à–µ—Å—Ç–µ—Ä–∫–µ –∏ The doors –¥–æ —É—Ç—Ä–∞, –ø—Ä–æ–≥—É–ª–æ–∫ –≤ –¥–æ–∂–¥–ª–∏–≤–æ–º –ø–∞—Ä–∏–∂–µ –∏ Rocky Horror picture show –≤–æ –≤—Ä–µ–º—è –∑–∞–≤—Ç—Ä–∞–∫–∞`,
          signature: "‚Äî –†–æ–º–∞"
        },
        {
          id: 'yulik-1',
          text: `–ö–∞–∂–µ—Ç—Å—è —è –∑–Ω–∞—é —Ç–µ–±—è –≤—Å—é –∂–∏–∑–Ω—å –∏–ª–∏ –ø–æ—á—Ç–∏ –≤—Å—é! –ò —Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–µ–±—è –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–ø–ª–æ –∏ —á—É–≤—Å—Ç–≤–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ–π –≥–æ—Ä–¥–æ—Å—Ç–∏, —á—Ç–æ –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏ –µ—Å—Ç—å —á–µ–ª–æ–≤–µ–∫ —É–º–µ—é—â–∏–π –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å –∏ –¥–∞–≤–∞—Ç—å –∑–∞—Ä—è–¥ –ø—Ä–æ—Å—Ç–æ —Å–≤–æ–∏–º –ø–æ—è–≤–ª–µ–Ω–∏–µ–º! –° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è –±–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ–±–µ–∑—å—è–Ω–∫–∞! üñ§`,
          signature: "‚Äî –Æ–ª–∏–∫"
        },
        {
          id: 'nadya-1',
          text: `–ñ–µ–Ω—è, —è –æ—á–µ–Ω—å —Ä–∞–¥–∞, —á—Ç–æ –º—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–ø–æ–ª–Ω—è—Ç—å –Ω–∞—à–∏ –ª–æ–∫–∞—Ü–∏–∏, –∏ —Å–µ–≥–æ–¥–Ω—è –º—ã –¥–µ–ª–∞–µ–º —ç—Ç–æ –≤ ?–ê—Å—Ç—Ä–∞—Ö–∞–Ω–∏?! –û—á–µ–Ω—å —Ç–µ–±—è –ª—é–±–ª—é –∏ –ø–æ–∑–¥—Ä–∞–≤–ª—è—é —Å —Ç–≤–æ–∏–º –¥–Ω–µ–º!`,
          signature: "‚Äî –ù–∞–¥—è"
        },
        {
          id: 'vadim-1',
          text: `Happy Birthday, Angel "A"! üéâ<br><br>–° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è, –¥–æ—Ä–æ–≥–∞—è –ñ–µ–Ω—è! –Ø –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –≥–æ—Ä–∂—É—Å—å –Ω–∞—à–µ–π –¥—Ä—É–∂–±–æ–π —Ç–∞ –∏ —Ç–µ–º, —á—Ç–æ –º—ã –≤–æ–æ–±—â–µ –∑–Ω–∞–∫–æ–º—ã).<br><br>–û—á–µ–Ω—å –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ —Å–∫–æ—Ä–æ —É–≤–∏–¥–∏–º—Å—è.`,
          signature: "‚Äî –í–∞–¥–∏–º"
        },
        {
          id: 'vadim-2',
          text: `–ñ–µ–ª–∞—é –µ—â–µ –±–æ–ª–µ–µ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –≤ –∫–∞—Ä—å–µ—Ä–µ ‚Äî –ø—É—Å—Ç—å –î–∂–∞—Ä–º—É—à —Å–Ω–∏–º–µ—Ç —Ç–µ–±—è –≤ —Å–≤–æ–µ–π –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–∏–Ω–µ!`,
          signature: "‚Äî –í–∞–¥–∏–º"
        },
        // {
        //   id: 'david-1',
        //   text: `–°—Ç–∞—Ä–∞—è —Å–ª–∏–≤–∞<br>–£ —Ö—Ä–∞–º–∞ —Ü–≤–µ—Ç–µ—Ç –ø—ã—à–Ω–µ–π.<br>–° –∫–∞–∂–¥–æ—é –≤–µ—Å–Ω–æ–π.`,
        //   signature: "‚Äî –î–∞–≤–∏–¥"
        // },
        {
          id: 'david-2',
          text: `–°–≤–µ—Ç–ª—è—á–∫–∏ –ª–µ—Ç—è—Ç<br>–ù–∞–¥ –ª–µ—Ç–Ω–µ—é —Ä–µ–∫–æ–π. –¢–≤–æ–π —Å–º–µ—Ö<br>–¢–µ–ø–ª–æ–º —Å–≤–æ–∏–º –≥—Ä–µ–µ—Ç.`,
          signature: "‚Äî –î–∞–≤–∏–¥"
        },
        {
          id: 'david-3',
          text: `–í–µ—Ç–µ—Ä —Å –≥–æ—Ä –ø–æ–¥—É–ª ‚Äî<br>–°–∫–æ–ª—å–∫–æ –∂–µ –∂—É—Ä–∞–≤–ª–µ–π<br>–í –Ω–µ–±–µ —Ç–≤–æ–∏—Ö –ª–µ—Ç!<br><br>`,
          signature: "‚Äî –î–∞–≤–∏–¥"
        },
        {
          id: 'david-4',
          text: `–ü–∏–æ–Ω –æ–ø–∞–ª,<br>–ù–æ –∫–æ—Ä–µ–Ω—å –µ–≥–æ –∫—Ä–µ–ø–æ–∫.<br>–ù–æ–≤—ã–π —Ä–æ—Å—Ç–æ–∫.`,
          signature: "‚Äî –î–∞–≤–∏–¥"
        },
        {
          id: 'kirill-1',
          text: `–ù–∞—Å –∂–¥—ë—Ç –∫–∞—Ä–∞–æ–∫–µ –≤ –ª—É—á—à–∏—Ö —Å—Ç–æ–ª–∏—Ü–∞—Ö –º–∏—Ä–∞`,
          signature: "‚Äî –ö–∏—Ä–∏–ª–ª"
        },
        {
          id: 'kirill-2',
          text: `–°–ø–∞—Å–∏–±–æ —á—Ç–æ —Ç—ã –µ—Å—Ç—å —É –Ω–∞—Å, –º—ã —Ç–µ–±—è –æ—á–µ–Ω—å –ª—é–±–∏–º!<br><br>–ö—Å—Ç–∞—Ç–∏, –ø—Ä–∏–µ—Ö–∞—Ç—å –≤ –ê—Å—Ç—Ä–∞—Ö–∞–Ω—å –±—ã–ª–æ —Å–∞–º–æ–π –ª—É—á—à–µ–π –∏–¥–µ–µ–π, —è –±–µ–∑—É–º–Ω–æ —Ä–∞–¥, —á—Ç–æ –º—ã —ç—Ç–æ —Å–¥–µ–ª–∞–ª–∏! –°–ø–∞—Å–∏–±–æ –∑–∞ –≤—Å—ë`,
          signature: "‚Äî –ö–∏—Ä–∏–ª–ª"
        },
        {
          id: 'danya-1',
          text: `–ü—É—Å—Ç—å —Å—á–∞—Å—Ç—å–µ –Ω–∞–∫—Ä—ã–≤–∞–µ—Ç –≤–æ–ª–Ω–∞–º–∏ —Å –∑–∞–≤–∏–¥–Ω–æ–π —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å—é –∏ –ª—é–±–æ–≤—å –∂–∏–≤—ë—Ç –≤ —Å–µ—Ä–¥—Ü–µ –∫–∞–∂–¥–æ–µ –º–≥–Ω–æ–≤–µ–Ω–∏–µ`,
          signature: "‚Äî –î–∞–Ω—è"
        }


      ];

      // –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π
      const WISHES_STORAGE_KEY = 'baku_wishes_views';

      // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage
      function getWishViewCounts () {
        try {
          const stored = localStorage.getItem(WISHES_STORAGE_KEY);
          return stored ? JSON.parse(stored) : {};
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∏–∑ localStorage:', error);
          return {};
        }
      }

      function saveWishViewCounts (counts) {
        try {
          localStorage.setItem(WISHES_STORAGE_KEY, JSON.stringify(counts));
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', error);
        }
      }

      function incrementWishView (wishId) {
        const counts = getWishViewCounts();
        counts[wishId] = (counts[wishId] || 0) + 1;
        saveWishViewCounts(counts);
        return counts[wishId];
      }

      function getWishViewCount (wishId) {
        const counts = getWishViewCounts();
        return counts[wishId] || 0;
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
      function resetWishViewCounts () {
        localStorage.removeItem(WISHES_STORAGE_KEY);
        console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —Å–±—Ä–æ—à–µ–Ω–∞');
      }

      // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
      function selectWishWithLeastViews () {
        const counts = getWishViewCounts();

        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
        const wishCounts = wishes.map(wish => ({
          wish: wish,
          count: counts[wish.id] || 0
        }));

        // –ù–∞—Ö–æ–¥–∏–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
        const minCount = Math.min(...wishCounts.map(wc => wc.count));

        // –í—ã–±–∏—Ä–∞–µ–º –∏–∑ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
        let leastViewedWishes = wishCounts.filter(wc => wc.count === minCount);

        // –ò—Å–∫–ª—é—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        if (lastSelectedWishId && leastViewedWishes.length > 1) {
          leastViewedWishes = leastViewedWishes.filter(wc => wc.wish.id !== lastSelectedWishId);
        }

        // –ï—Å–ª–∏ –ø–æ—Å–ª–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ
        if (leastViewedWishes.length === 0) {
          leastViewedWishes = wishCounts.filter(wc => wc.count === minCount);
        }

        // –°–ª—É—á–∞–π–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º –æ–¥–Ω–æ –∏–∑ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
        const selectedWish = leastViewedWishes[Math.floor(Math.random() * leastViewedWishes.length)];

        // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
        lastSelectedWishId = selectedWish.wish.id;

        return selectedWish.wish;
      }

      // –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
      async function fetchWithProgress (url, onProgress) {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);

        const contentLength = +response.headers.get('Content-Length');
        if (!contentLength) {
          // –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ
          const blob = await response.blob();
          onProgress(blob.size, blob.size);
          return blob;
        }

        const reader = response.body.getReader();
        const chunks = [];
        let receivedLength = 0;

        while (true) {
          const { done, value } = await reader.read();
          if (done) break;

          chunks.push(value);
          receivedLength += value.length;
          onProgress(receivedLength, contentLength);
        }

        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —á–∞–Ω–∫–∏ –≤ –æ–¥–∏–Ω Uint8Array
        const chunksAll = new Uint8Array(receivedLength);
        let position = 0;
        for (const chunk of chunks) {
          chunksAll.set(chunk, position);
          position += chunk.length;
        }

        return new Blob([chunksAll]);
      }

      async function preloadVideos (urls, onProgress) {
        const items = [];

        for (let i = 0; i < urls.length; i++) {
          const url = urls[i];
          const fileName = url.split('/').pop();

          onProgress(0, 100, `–ó–∞–≥—Ä—É–∑–∫–∞ ${fileName}...`, `–§–∞–π–ª ${i + 1} –∏–∑ ${urls.length}`);

          const blob = await fetchWithProgress(url, (loaded, total) => {
            const fileProgress = Math.round((loaded / total) * 100);
            const overallProgress = Math.round(((i + (loaded / total)) / urls.length) * 100);
            const sizeInfo = `${Math.round(loaded / 1024)}KB / ${Math.round(total / 1024)}KB`;
            onProgress(overallProgress, 100, `–ó–∞–≥—Ä—É–∑–∫–∞ ${fileName}... ${fileProgress}%`, sizeInfo);
          });

          const objectUrl = URL.createObjectURL(blob);
          const el = document.createElement("video");
          el.src = objectUrl;
          el.muted = true;
          el.playsInline = true;
          el.style.position = 'absolute';
          el.style.inset = '0';
          el.style.width = '100%';
          el.style.height = '100%';
          el.style.objectFit = 'cover';
          el.style.opacity = '0';
          el.style.transition = 'opacity 200ms linear';

          document.getElementById('stage').appendChild(el);
          items.push({ url, objectUrl, element: el });

          onProgress(Math.round(((i + 1) / urls.length) * 100), 100, `${fileName} –∑–∞–≥—Ä—É–∂–µ–Ω`, '–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ...');
        }

        // –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –≤–∏–¥–µ–æ
        onProgress(90, 100, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤–∏–¥–µ–æ...', '–û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é');
        await Promise.all(items.map(({ element }) =>
          new Promise(resolve => {
            element.addEventListener("canplaythrough", resolve, { once: true });
            element.addEventListener("loadedmetadata", resolve, { once: true });
            element.load();
          })
        ));

        return { items };
      }


      const nextBtn = document.getElementById('nextBtn');
      const showBtn = document.getElementById('showBtn');
      const stage = document.getElementById('stage');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const progressBar = document.getElementById('progressBar');
      const loadingText = document.getElementById('loadingText');
      const loadingDetails = document.getElementById('loadingDetails');
      const mainScreen = document.getElementById('mainScreen');
      const whishesText = document.getElementById('whishesText');
      const wishesSignature = document.getElementById('wishesSignature');

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π
      function updateWishes () {
        const selectedWish = selectWishWithLeastViews();
        const wishesContent = whishesText.querySelector('.wishes-content');
        wishesContent.innerHTML = selectedWish.text;
        wishesSignature.textContent = selectedWish.signature;

        // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ - –≤—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –∫–æ–Ω—Å–æ–ª—å
        console.log('–í—ã–±—Ä–∞–Ω–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ:', selectedWish.id, '–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤:', getWishViewCount(selectedWish.id));
        console.log('–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', getWishViewCounts());

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞
        return selectedWish;
      }

      let lastId = null;
      let lookIndex = 0; // –ò–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–µ–æ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Look (–ø–æ –∫—Ä—É–≥—É)
      let current = null;
      let reverseInterval = null; // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
      let isReversing = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
      let lastSelectedWishId = null; // ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
      let currentSelectedWish = null; // –¢–µ–∫—É—â–µ–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ

      // –ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
      function showError (message) {
        console.error(message);
      }

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
      const CONFIG = {
        videoPlaybackRate: 1.3,
        rewindSpeed: 5.0,
        rewindInterval: 30,
        fadeDuration: 200,
        autoStartDelay: 100,
        // –°–∫–æ—Ä–æ—Å—Ç–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
        videoSpeeds: {
          'bouquet': 1.3,
          'paper': 2,    // –£—Å–∫–æ—Ä—è–µ–º paper.mp4 –≤ 1.5 —Ä–∞–∑–∞
          'dance': 1.3,
          'blowKiss': 1.3,
          'twerk': 1.3
        }
      };

      function pickNext () {
        // –ö–Ω–æ–ø–∫–∞ Next –≤—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ (paper)
        return clips.find(c => c.id === 'paper');
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–∏–¥–µ–æ –ø–æ ID
      function pickVideoById (videoId) {
        return clips.find(c => c.id === videoId);
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–∏–¥–µ–æ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Look (–ø–æ –∫—Ä—É–≥—É)
      function pickLookVideo () {
        const lookVideos = ['bouquet', 'dance', 'blowKiss', 'twerk'];
        // –í—ã–±–∏—Ä–∞–µ–º –≤–∏–¥–µ–æ –ø–æ –∫—Ä—É–≥—É
        const selectedVideoId = lookVideos[lookIndex];
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—ã–∑–æ–≤–∞ (—Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º –∫ –Ω–∞—á–∞–ª—É)
        lookIndex = (lookIndex + 1) % lookVideos.length;
        return pickVideoById(selectedVideoId);
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–∏–¥–µ–æ
      function playSpecificVideo (videoClip) {
        if (isReversing) return;

        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        mainScreen.style.display = 'none';
        mainScreen.classList.remove('visible');

        // –°–∫—Ä—ã–≤–∞–µ–º wishes-text –∏ –ø–æ–¥–ø–∏—Å—å –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ
        whishesText.classList.remove('show');
        wishesSignature.classList.remove('show');

        if (current && current.el.currentTime > 0) {
          if (reverseInterval) {
            clearInterval(reverseInterval);
            reverseInterval = null;
          }

          isReversing = true;
          const video = current.el;

          reverseInterval = setInterval(() => {
            const newTime = video.currentTime - (CONFIG.rewindInterval / 1000) * CONFIG.rewindSpeed;

            if (newTime <= 0) {
              clearInterval(reverseInterval);
              reverseInterval = null;
              video.currentTime = 0;
              video.pause();
              current = null;
              isReversing = false;

              // –ò—Å–ø–æ–ª—å–∑—É–µ–º setTimeout –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ iPhone
              setTimeout(() => {
                playSpecificVideo(videoClip);
              }, 50);
              return;
            } else {
              video.currentTime = newTime;
            }
          }, CONFIG.rewindInterval);
          return;
        }

        lastId = videoClip.id;
        current = videoClip;
        const videoToPlay = videoClip.el;

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
        videoToPlay.playbackRate = CONFIG.videoSpeeds[videoClip.id] || CONFIG.videoPlaybackRate;
        videoToPlay.currentTime = 0;
        videoToPlay.addEventListener('ended', onEnded, { once: true });

        videoToPlay.style.opacity = '1';

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–ª—è iPhone - –∂–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ
        const playVideo = () => {
          videoToPlay.play().catch(e => {
            console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', e);
            videoToPlay.style.opacity = '0';
            mainScreen.style.display = 'flex';
            mainScreen.classList.add('visible');
          });
        };

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º
        if (videoToPlay.readyState >= 3) { // HAVE_FUTURE_DATA
          playVideo();
        } else {
          videoToPlay.addEventListener('canplay', playVideo, { once: true });
          videoToPlay.addEventListener('loadeddata', playVideo, { once: true });
          // Fallback –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—é—Ç
          setTimeout(playVideo, 100);
        }

        setTimeout(() => {
          clips.forEach(c => {
            if (c.id !== videoClip.id) {
              c.el.pause();
              c.el.currentTime = 0;
              c.el.style.opacity = '0';
            }
          });
        }, 200);
      }

      function fadeIn (el) {
        el.style.transition = `opacity ${CONFIG.fadeDuration}ms linear`;
        el.style.opacity = '1';
      }
      function fadeOut (el) {
        el.style.transition = `opacity ${CONFIG.fadeDuration}ms linear`;
        el.style.opacity = '0';
      }


      function stopAll () {
        if (reverseInterval) {
          clearInterval(reverseInterval);
          reverseInterval = null;
        }
        isReversing = false;
        for (const c of clips) {
          c.el.pause();
          c.el.currentTime = 0;
          c.el.style.opacity = '0';
        }
        // –°–∫—Ä—ã–≤–∞–µ–º wishes-text –∏ –ø–æ–¥–ø–∏—Å—å –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
        whishesText.classList.remove('show');
        wishesSignature.classList.remove('show');
      }

      function onEnded () {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º wishes-text –∏ –ø–æ–¥–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∏–¥–µ–æ "paper"
        if (current && current.id === 'paper') {
          whishesText.classList.add('show');
          wishesSignature.classList.add('show');

          // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
          if (currentSelectedWish) {
            incrementWishView(currentSelectedWish.id);
            console.log('–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ:', currentSelectedWish.id, '–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤:', getWishViewCount(currentSelectedWish.id));
            currentSelectedWish = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
          }
        }

        mainScreen.style.display = 'flex';
        mainScreen.classList.add('visible');
      }


      function playNext () {
        if (isReversing) return;

        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ï—â—ë —Ä–∞–∑" –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        mainScreen.style.display = 'none';
        mainScreen.classList.remove('visible');

        // –°–∫—Ä—ã–≤–∞–µ–º wishes-text –∏ –ø–æ–¥–ø–∏—Å—å –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ
        whishesText.classList.remove('show');
        wishesSignature.classList.remove('show');

        if (current && current.el.currentTime > 0) {
          if (reverseInterval) {
            clearInterval(reverseInterval);
            reverseInterval = null;
          }

          isReversing = true;
          const video = current.el;

          reverseInterval = setInterval(() => {
            const newTime = video.currentTime - (CONFIG.rewindInterval / 1000) * CONFIG.rewindSpeed;

            if (newTime <= 0) {
              clearInterval(reverseInterval);
              reverseInterval = null;
              video.currentTime = 0;
              video.pause();
              current = null;
              isReversing = false;

              // –ò—Å–ø–æ–ª—å–∑—É–µ–º setTimeout –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ iPhone
              setTimeout(() => {
                playNext();
              }, 50);
              return;
            } else {
              video.currentTime = newTime;
            }
          }, CONFIG.rewindInterval);
          return;
        }

        const next = pickNext();
        lastId = next.id;
        current = next;
        const videoToPlay = next.el;

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è paper –≤–∏–¥–µ–æ (–∫–Ω–æ–ø–∫–∞ Next)
        if (next.id === 'paper') {
          currentSelectedWish = updateWishes();
        }

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
        videoToPlay.playbackRate = CONFIG.videoSpeeds[next.id] || CONFIG.videoPlaybackRate;
        videoToPlay.currentTime = 0;
        videoToPlay.addEventListener('ended', onEnded, { once: true });

        videoToPlay.style.opacity = '1';

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–ª—è iPhone - –∂–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ
        const playVideo = () => {
          videoToPlay.play().catch(e => {
            console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', e);
            videoToPlay.style.opacity = '0';
            mainScreen.style.display = 'flex';
            mainScreen.classList.add('visible');
          });
        };

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º
        if (videoToPlay.readyState >= 3) { // HAVE_FUTURE_DATA
          playVideo();
        } else {
          videoToPlay.addEventListener('canplay', playVideo, { once: true });
          videoToPlay.addEventListener('loadeddata', playVideo, { once: true });
          // Fallback –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—é—Ç
          setTimeout(playVideo, 100);
        }

        setTimeout(() => {
          clips.forEach(c => {
            if (c.id !== next.id) {
              c.el.pause();
              c.el.currentTime = 0;
              c.el.style.opacity = '0';
            }
          });
        }, 200);
      }

      nextBtn.addEventListener('click', () => {
        if (!isReversing) {
          playNext();
        }
      });

      showBtn.addEventListener('click', () => {
        if (!isReversing) {
          // –í—ã–±–∏—Ä–∞–µ–º –≤–∏–¥–µ–æ –¥–ª—è Look (–ø–æ –∫—Ä—É–≥—É)
          const selectedVideo = pickLookVideo();

          if (selectedVideo) {
            playSpecificVideo(selectedVideo);
          }
        }
      });

      async function waitForAssets () {
        let progress = 0;
        let currentTask = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...';

        function updateUI (progressValue, task, details) {
          progress = progressValue;
          progressBar.style.width = `${progress}%`;
          loadingText.textContent = task || `–ó–∞–≥—Ä—É–∑–∫–∞... ${Math.round(progress)}%`;
          if (details) {
            loadingDetails.textContent = details;
          }
        }

        try {
          // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
          const videoUrls = clips.map(c => c.src);
          const { items } = await preloadVideos(videoUrls, (progressValue, total, task, details) => {
            // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –≤–∏–¥–µ–æ –æ—Ç 0% –¥–æ 90%
            const scaledProgress = (progressValue / 100) * 90;
            updateUI(scaledProgress, task, details);
          });

          clips.forEach((clip, index) => {
            clip.el = items[index].element;
          });

          updateUI(100, '–ì–æ—Ç–æ–≤–æ!', '–í—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');

          setTimeout(() => {
            loadingIndicator.style.display = 'none';
            stage.classList.remove('loading');
            mainScreen.classList.add('visible');
          }, 500);

        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
          updateUI(100, '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', error.message);
          setTimeout(() => {
            loadingIndicator.style.display = 'none';
            stage.classList.remove('loading');
            mainScreen.classList.add('visible');
          }, 500);
        }
      }

      waitForAssets();

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã - —Å–±—Ä–æ—Å –≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏
      let isPageVisible = true;

      document.addEventListener('visibilitychange', function () {
        if (document.hidden) {
          // –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∫—Ä—ã—Ç–∞
          isPageVisible = false;
          console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∫—Ä—ã—Ç–∞');
        } else {
          // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–∫—Ç–∏–≤–Ω–∞ - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å—ë –≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
          isPageVisible = true;
          console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–∫—Ç–∏–≤–Ω–∞, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ');
          resetToInitialState();
        }
      });

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —Ñ–æ–∫—É—Å–∞ –æ–∫–Ω–∞ –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞
      window.addEventListener('blur', function () {
        console.log('–û–∫–Ω–æ –ø–æ—Ç–µ—Ä—è–ª–æ —Ñ–æ–∫—É—Å');
      });

      window.addEventListener('focus', function () {
        console.log('–û–∫–Ω–æ –ø–æ–ª—É—á–∏–ª–æ —Ñ–æ–∫—É—Å, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ');
        resetToInitialState();
      });

      // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ –≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      function resetToInitialState () {
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –≤–∏–¥–µ–æ
        stopAll();

        // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω "–°–ª–µ–¥—É—é—â–µ–µ"
        mainScreen.style.display = 'none';
        mainScreen.classList.remove('visible');

        // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π
        whishesText.classList.remove('show');
        wishesSignature.classList.remove('show');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω —Å –∫–Ω–æ–ø–∫–∞–º–∏
        mainScreen.style.display = 'flex';
        mainScreen.classList.add('visible');

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ
        current = null;
        lastId = null;
        lookIndex = 0;

        console.log('–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–±—Ä–æ—à–µ–Ω–æ –≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ');
      }

      // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
      window.resetWishStats = resetWishViewCounts;
      window.getWishStats = getWishViewCounts;
      window.resetToInitial = resetToInitialState;

      // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
      // resetWishStats() - —Å–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
      // getWishStats() - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
      // resetToInitial() - —Å–±—Ä–æ—Å–∏—Ç—å –≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

    })();
  </script>
</body>

</html>
